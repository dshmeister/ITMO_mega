import requests
import concurrent.futures
import time
import pandas as pd

# –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–∏—Å–∞
URL = "http://78.111.88.52:13001/api/request"



# –í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –ò–¢–ú–û
QUESTIONS = [
  {"query": "–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ò–¢–ú–û?\n1. 1899\n2. 1900\n3. 1920\n4. 1950", "id": 1},
  {"query": "–ö–∞–∫–æ–π –¥–µ–≤–∏–∑ —É –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –ò–¢–ú–û?\n1. –†–∞–∑—É–º, –°–æ–∑–∏–¥–∞–Ω–∏–µ, –ë—É–¥—É—â–µ–µ\n2. –ù–∞—É–∫–∞, –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –ü—Ä–æ–≥—Ä–µ—Å—Å\n3. –ë–æ–ª—å—à–µ —á–µ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç\n4. –£—á–∏—Å—å, —Å–æ–∑–¥–∞–≤–∞–π, –º–µ–Ω—è–π –º–∏—Ä", "id": 2},
  {"query": "–í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–ª–∞–≤–Ω—ã–π –∫–∞–º–ø—É—Å –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –ò–¢–ú–û?\n1. –ú–æ—Å–∫–≤–∞\n2. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥\n3. –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥\n4. –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "id": 3},
  {"query": "–ö–∞–∫–æ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç –ò–¢–ú–û —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?\n1. –§–∞–∫—É–ª—å—Ç–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º\n2. –§–∞–∫—É–ª—å—Ç–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n3. –§–∞–∫—É–ª—å—Ç–µ—Ç –±–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\n4. –§–∞–∫—É–ª—å—Ç–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "id": 4},
  {"query": "–ö–∞–∫–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –≤ –ò–¢–ú–û –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –∫–≤–∞–Ω—Ç–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏?\n1. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞\n2. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∫–≤–∞–Ω—Ç–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏\n3. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è\n4. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –±–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "id": 5},
  {"query": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–π —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–π –∫–æ–Ω–∫—É—Ä—Å –ò–¢–ú–û –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é?\n1. ICPC\n2. Codeforces Challenge\n3. ACM ITMO Battle\n4. Google Hash Code", "id": 6},
  {"query": "–ö–∞–∫–æ–π —Ä–µ–π—Ç–∏–Ω–≥ QS World University Rankings –∑–∞–Ω–∏–º–∞–µ—Ç –ò–¢–ú–û –≤ 2024 –≥–æ–¥—É?\n1. 201-250\n2. 300-350\n3. 400-450\n4. 500-550", "id": 7},
  {"query": "–ö–∞–∫–æ–π –ø—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å—Ç–∏–ª –ò–¢–ú–û –≤ —Å—Ñ–µ—Ä–µ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?\n1. CTF ITMO\n2. ITMO SecureNet\n3. ITMO Cybersecurity Hub\n4. Cyber Defense Academy", "id": 8},
  {"query": "–í –∫–∞–∫–æ–º –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º –∫–æ–Ω–∫—É—Ä—Å–µ –ø–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É —É—á–∞—Å—Ç–≤—É—é—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã –ò–¢–ú–û?\n1. Kaggle AI Challenge\n2. NeurIPS Competition\n3. ImageNet Challenge\n4. AI Hackathon", "id": 9},
  {"query": "–ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –∏–º–µ–µ—Ç –ò–¢–ú–û –≤ —Å–∏—Å—Ç–µ–º–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≤—É–∑–æ–≤?\n1. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç\n2. –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç\n3. –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç\n4. –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "id": 10},
  {"query": "–ö–∞–∫–æ–π –ø—Ä–æ–µ–∫—Ç –≤ –ò–¢–ú–û —Å–≤—è–∑–∞–Ω —Å —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–æ–π?\n1. ITMO Robotics Lab\n2. AI & Robotics Center\n3. ITMO RoboCup\n4. Cyber Robotics Lab", "id": 11},
  {"query": "–ö–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç –Ω–∞ –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö —á–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã –ò–¢–ú–û?\n1. –§–∏–∑–∏–∫–∞\n2. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞\n3. –•–∏–º–∏—è\n4. –ë–∏–æ–ª–æ–≥–∏—è", "id": 12},
  {"query": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞—É—á–Ω—ã–π –ø–∞—Ä–∫ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –ò–¢–ú–û?\n1. ITMO Science Park\n2. ITMO Technopark\n3. ITMO Innovation Hub\n4. ITMO Digital Valley", "id": 13},
  {"query": "–ö–∞–∫–æ–π –≥—Ä–∞–Ω—Ç –≤—ã–∏–≥—Ä–∞–ª –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ò–¢–ú–û –≤ 2022 –≥–æ–¥—É?\n1. –ì—Ä–∞–Ω—Ç –°–∫–æ–ª–∫–æ–≤–æ\n2. –ì—Ä–∞–Ω—Ç –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –Ω–∞—É–∫–∏\n3. –ì—Ä–∞–Ω—Ç '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2030'\n4. –ì—Ä–∞–Ω—Ç AI Development", "id": 14},
  {"query": "–° –∫–∞–∫–∏–º –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ—Ç –ò–¢–ú–û –≤ –æ–±–ª–∞—Å—Ç–∏ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π?\n1. MIT\n2. ETH Zurich\n3. University of Cambridge\n4. TU Delft", "id": 15},
  {"query": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –ò–¢–ú–û?\n1. www.itmo.ru\n2. www.itmo.edu\n3. www.itmo.ac\n4. www.itmo.org", "id": 16},
  {"query": "–ö–∞–∫–∞—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω–∞ —Å—Ä–µ–¥–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ò–¢–ú–û?\n1. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è\n2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n3. –ö–≤–∞–Ω—Ç–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\n4. –†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", "id": 17},
  {"query": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –≤ –ò–¢–ú–û?\n1. ITMO Global Exchange\n2. ITMO International Mobility\n3. ITMO Study Abroad\n4. ITMO Worldwide", "id": 18},
  {"query": "–°–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ–±—É—á–∞–µ—Ç—Å—è –≤ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ –ò–¢–ú–û?\n1. 5 000\n2. 10 000\n3. 15 000\n4. 20 000", "id": 19},
  {"query": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è AI-–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –≤ –ò–¢–ú–û?\n1. ITMO AI Lab\n2. ITMO Digital Mind\n3. ITMO DeepTech\n4. AI Research Hub", "id": 20},
  {"query": "–ö–∞–∫–æ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç –≤ –ò–¢–ú–û –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–ª–æ–∫—á–µ–π–Ω-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏?\n1. –§–∞–∫—É–ª—å—Ç–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n2. –§–∞–∫—É–ª—å—Ç–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤\n3. –§–∞–∫—É–ª—å—Ç–µ—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\n4. –§–∞–∫—É–ª—å—Ç–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏", "id": 21},
  {"query": "–ö–∞–∫–æ–π –ø–∞—Ä—Ç–Ω–µ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ—Ç —Å –ò–¢–ú–û –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π?\n1. Google Quantum AI\n2. IBM Q\n3. Microsoft Quantum\n4. Intel Quantum Lab", "id": 22},
  {"query": "–ö–∞–∫–æ–π –Ω–æ–≤—ã–π –∫–∞–º–ø—É—Å —Å—Ç—Ä–æ–∏—Ç –ò–¢–ú–û?\n1. ITMO High-Tech Campus\n2. ITMO Innovation Valley\n3. ITMO Digital Hub\n4. ITMO Quantum Park", "id": 23},
  {"query": "–ö–∞–∫–æ–π –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä—É–º –ø–æ –Ω–∞—É–∫–µ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –ò–¢–ú–û?\n1. ITMO Science Conference\n2. ITMO Future Forum\n3. ITMO Open Science\n4. ITMO Innovations", "id": 24},
  {"query": "–ö–∞–∫–æ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –±–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–æ–π?\n1. –§–∞–∫—É–ª—å—Ç–µ—Ç –±–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\n2. –§–∞–∫—É–ª—å—Ç–µ—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –Ω–∞—É–∫\n3. –§–∞–∫—É–ª—å—Ç–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏\n4. –§–∞–∫—É–ª—å—Ç–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", "id": 25}
]

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
def send_request(question):
    start_time = time.time()
    response = requests.post(URL, params=question)
    end_time = time.time()
    elapsed_time = end_time - start_time

    try:
        response_json = response.json()
    except requests.exceptions.JSONDecodeError:
        response_json = {"error": "–ù–µ JSON", "raw_response": response.text}

    return question["id"], response.status_code, elapsed_time, response_json

# –§—É–Ω–∫—Ü–∏—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
def run_stress_test(batch_size, iterations):
    results = []
    total_time = 0

    print(f"\nüî• –ó–∞–ø—É—Å–∫ {iterations} —Ç–µ—Å—Ç–æ–≤ –ø–æ {batch_size} –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ üî•")

    for i in range(iterations):
        batch = QUESTIONS[:batch_size]
        with concurrent.futures.ThreadPoolExecutor(max_workers=batch_size) as executor:
            batch_results = list(executor.map(send_request, batch))

        for req_id, status, elapsed_time, response_json in batch_results:
            results.append({
                "–ó–∞–ø—Ä–æ—Å ID": req_id,
                "HTTP –ö–æ–¥": status,
                "–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫)": round(elapsed_time, 4),
                "–û—Ç–≤–µ—Ç JSON?": isinstance(response_json, dict),
                "–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞": response_json
            })
            total_time += elapsed_time

        print(f"üü¢ –ò—Ç–µ—Ä–∞—Ü–∏—è {i+1}/{iterations} –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

    return results, total_time

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
final_results = []
total_test_time = 0

# 2 —Ä–∞–∑–∞ –ø–æ 5 –∑–∞–ø—Ä–æ—Å–æ–≤
results, test_time = run_stress_test(10, 5)
final_results.extend(results)
total_test_time += test_time

# 2 —Ä–∞–∑–∞ –ø–æ 25 –∑–∞–ø—Ä–æ—Å–æ–≤
# results, test_time = run_stress_test(25, 2)
# final_results.extend(results)
# total_test_time += test_time

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DataFrame –∏ –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
df = pd.DataFrame(final_results)

# –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª—å
print(df.to_string())

# –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ CSV-—Ñ–∞–π–ª
df.to_csv("stress_test_results.csv", index=False)

# –ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è
print(f"\n‚è± –°—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤: {total_test_time:.4f} —Å–µ–∫")
